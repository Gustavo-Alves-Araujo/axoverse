<% if user_signed_in? %>
  <div class="actiom">
    <div class="profile-settings" onclick="menuToggle();">
      <%= profile_picture_of(current_user)%>
    </div>
    <div class="menu-perfil">
      <h3 class="menu-perfil-titulo"> <%= current_user.name %> </h3>
      <ul>
        <li><i class="fa-solid fa-user"></i> <%= link_to "editar perfil", previa_user_path(current_user) %></li>
        <li><i class="fa-sharp fa-solid fa-screwdriver-wrench"></i> <%= link_to "Configurações", edit_user_registration_path %></li>
        <li><i class="fa-solid fa-circle-question"></i> <a href="/ajudeme">Ajude-me</a></li>
        <li><i class="fa-solid fa-right-from-bracket"></i> <%= button_to "Sair", destroy_user_session_path, method: :delete, class:'botao-sair' %></li>
      </ul>
    </div>
    <script>
      function menuToggle(){
          const toggleMenu = document.querySelector('.menu-perfil')
          toggleMenu.classList.toggle('active')
      }
    </script>
  </div>
  <div class="usi-container">
    <div class="usi-side">
      <div class="usi-header">
        <div class="usi-side-avatar">
          <%= profile_picture_of(current_user)%>
        </div>
        <div class="usi-title">
          <%= current_user.name %>
        </div>
      </div>
      <div class="usi-menu">
        <ul>
          <li><%= link_to 'Matches', root_path%></li>
          <li class="usi-active">Chats</li>
        </ul>
      </div>
      <%= turbo_stream_from @room %>
      <% @rooms.each do |room|%>
        <%= link_to room_path(room) do %>
          <div class="usi-messages">
            <div class="usi-avatar">
              <%= profile_picture_of(contact_info(room))%>
            </div>
            <div class="usi-friend">
              <div class="usi-user"><%= contact_info(room).name%></div>
              <div class="usi-text"><%= room.messages.last&.body%></div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
    <% if @messages%>
      <%= stylesheet_link_tag "chat.css", :media => "all" %>
      <style>
        <%= ".msg-#{current_user&.id}" %> {
        	background-color: rgb(143, 209, 117);
        	align-self: flex-end;
        	color: white !important;
        }
      </style>
      <div class="usi-content">
        <div class="chat-area bg-white" data-controller="scroll">
          <%= turbo_stream_from "messages" %>
          <%= render 'messages/messages', messages: @messages %>
        </div>
      </div>
    <% else %>
      <div class="usi-content">
        <% @users_to_chat_with.each do |user| %>
          <div class="usi-card">
            <div class="usi-user-recomendado">
              <%= profile_picture_of(user, 'usi-user-recomendado')%>
              <div class="usi-user-recomendado-profile">
                <div class="usi-user-recomendado-name"><%= user.name %> <span><%= user.age%></span> </div>
                <div class="usi-user-recomendado-local">
                  <i class="fas fa-map-marker alt"></i>
                  <span>Itaquera, São Paulo</span>
                </div>
              </div>
            </div>
          </div>
          <div class="usi-buttons">
            <div class="no">
              <i class="fas fa-times"></i>
            </div>
            <div class="star">
              <i class="fas fa-star fa"></i>
            </div>
            <div class="heart">
              <%= form_with( model: Room.new, class: 'd-flex form-match d-none') do |f|%>
                <%= hidden_field_tag :receiver_user_id, user.id  %>
                <%= f.submit %>
              <% end %>
              <i class="fas fa-heart" id="chat-with" data-controller="match" data-action="click->match#submitForm"></i>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
<% else %>
  <div class="home">
    <header class="cabecalho">
      <%= link_to root_path do %>
        <%= image_tag asset_path('logoaxo.png'), class:'cabecalho-logo'%>
      <% end %>
      <nav class="cabecalho-menu">
        <%= button_to 'Login', new_user_session_path, method: :get, class:'cabecalho-menu-botao-login' %>
        <%= button_to 'Registre-se', new_user_registration_path, method: :get, class: 'cabecalho-menu-botao-criar'  %>
      </nav>
    </header>
    <main class="conteudo">
      <section class="conteudo-principal">
        <div class="conteudo-principal-escrito">
          <h1 class="conteudo-principal-escrito-titulo"> Axo </h1>
          <h2 class="conteudo-principal-escrito-subtitulo"> Um site para interação social entre alunos da etec.</h2>
          <%= button_to 'Acesse aqui', new_user_session_path, method: :get, class:'conteudo-principal-escrito-botao' %>
        </div>
        <%= image_tag asset_path('axohome.png'), class:'conteudo-principal-imagem'%>
      </section>
      <section class="conteudo-secundario">
        <h3 class="conteudo-secundario-titulo"> <strong>O que é o axo?</strong> </h3>
        <p class="conteudo-secundario-paragrafo"> 1 - A primeira criação da axoverse, com o intuito de ajudar na socialização de alunos da etec. </p>
        <p class="conteudo-secundario-paragrafo"> 2 - Com uma interface intuitiva, o usuário pode encontrar facilmente outros alunos com os mesmos gostos. </p>
        <p class="conteudo-secundario-paragrafo"> 3 - O site conta com um sistema de chat quando ambos os alunos se interessam um no outro.</p>
      </section>
    </main>
    <footer class="rodape">
      <p class="rodape-titulo"> Axoverse </p>
    </footer>
  </div>
<% end %>
